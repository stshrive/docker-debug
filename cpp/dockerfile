FROM ubuntu

RUN apt-get update -qq \
    && apt-get install -y --no-install-recommends \
        g++

# Use unique location to pull in project from local machine.
# We can mount over this location with our local version when
# using the docker run command to build this on the fly.
#
ARG PROJECT_SRC

ENV APP_LIBS /app/lib
ENv APP_BIN  /app/bin

RUN mkdir -p \
    ${PROJECT_SRC} \
    ${APP_LIBS} \
    ${APP_BIN}

COPY . ${PROJECT_SRC}

RUN    g++ -o ${APP_LIBS}/library.o -c -I${PROJECT_SRC}/include ${PROJECT_SRC}/src/library.cpp \
    && g++ -o ${APP_LIBS}/main.o    -c -I${PROJECT_SRC}/include ${PROJECT_SRC}/src/main.cpp \
    && g++ -o ${APP_BIN}/add ${APP_LIBS}/library.o ${APP_LIBS}/main.o

ENV PATH ${PATH}:${APP_BIN}

WORKDIR /

# In order to make sure you can attach to your container, don't set
# the entrypoint to the application "add". Instead make sure you are
# executing your application through a shell
ENTRYPOINT ["/bin/bash", "-c"]

# This will get executed as /bin/bash -c add
CMD ["add"]
